<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Exchange</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 500px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 50px;
            text-align: right;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        label {
            font-size: 16px;
            margin-bottom: 10px;
            display: block;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            text-align: right;
            box-sizing: border-box;
        }

        button {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result {
            font-size: 18px;
            margin-top: 20px;
            color: #28a745;
            text-align: right;
        }

        .chat-button {
            display: none;
            background-color: #28a745;
        }

        .chat-button:hover {
            background-color: #218838;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Easy Exchange</h1>
        <div id="step1">
            <label for="operationType">اختر نوع العملية:</label>
            <select id="operationType">
                <option value="1">سحب</option>
                <option value="2" selected>إيداع</option>
            </select>

            <label for="transactionType">اختر نوع التحويل:</label>
            <select id="transactionType">
                <option value="1">أريد دفع مبلغ</option>
                <option value="2" selected>أريد أن يصلني</option>
            </select>

            <label for="paymentMethod">حدد طريقة التحويل:</label>
            <select id="paymentMethod">
                <option value="wallet">المحافظ الإلكترونية</option>
                <option value="instapay">انستا باي</option>
                <option value="fawry">كارت فوري</option>
                <option value="telda">كارت تيلدا</option>
            </select>

            <label id="inputLabel" for="amountInput">برجاء ذكر المبلغ بالدولار:</label>
            <input type="number" id="amountInput" placeholder="أدخل المبلغ" />

            <button onclick="calculate()">احسب</button>
        </div>

        <div id="result" class="result"></div>

        <div id="chatButtonContainer">
            <button id="chatButton" class="chat-button">التوجه إلى الدردشة</button>
        </div>
    </div>

    <script>
        let operationType = 2;
        let transactionType = 2;

        function updateLabel() {
            operationType = parseInt(document.getElementById('operationType').value);
            transactionType = parseInt(document.getElementById('transactionType').value);

            let inputLabel = document.getElementById('inputLabel');
            if (operationType === 1 && transactionType === 1) {
                inputLabel.textContent = "برجاء ذكر المبلغ بالدولار:";
            } else if (operationType === 1 && transactionType === 2) {
                inputLabel.textContent = "برجاء ذكر المبلغ بالجنيه:";
            } else if (operationType === 2 && transactionType === 1) {
                inputLabel.textContent = "برجاء ذكر المبلغ بالجنيه:";
            } else if (operationType === 2 && transactionType === 2) {
                inputLabel.textContent = "برجاء ذكر المبلغ بالدولار:";
            }
        }

        document.getElementById('operationType').addEventListener('change', updateLabel);
        document.getElementById('transactionType').addEventListener('change', updateLabel);

        function calculate() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            const paymentMethod = document.getElementById('paymentMethod').value;

            if (isNaN(amount) || amount <= 0) {
                alert("برجاء إدخال مبلغ صحيح.");
                return;
            }

            let fee = 0;
            if (paymentMethod === "instapay" || paymentMethod === "fawry" || paymentMethod === "telda") {
                // عند اختيار انستا باي، كارت تيلدا، أو كارت فوري، تكون الرسوم 0%
                fee = 0;
            } else if (operationType === 1) {
                // عند اختيار السحب تكون الرسوم ثابتة 0%
                fee = 0;
            } else if (operationType === 2 && transactionType === 2 && paymentMethod === "wallet") {
                // عند اختيار إيداع مع أريد أن يصلني مع المحافظ الإلكترونية
                const amountInEGP = amount * 52;
                fee = 0.57 / 100;
                const totalAmount = amountInEGP * (1 + fee);
                displayResult(amount, "USD", totalAmount, "EGP", fee);
                return;
            } else if (operationType === 2 && transactionType === 1) {
                // عند اختيار إيداع مع أريد دفع مبلغ
                fee = 0.57 / 100;
            }

            let adjustedAmount = amount * (1 - fee); // طرح الرسوم
            let roundedAmount = Math.floor(adjustedAmount); // تقريب المبلغ لأقرب عدد صحيح أصغر

            let convertedAmount = 0;
            if (operationType === 1 && transactionType === 1) {
                convertedAmount = roundedAmount * 49;
                displayResult(amount, "USD", convertedAmount, "EGP", fee);
            } else if (operationType === 1 && transactionType === 2) {
                convertedAmount = roundedAmount / 49;
                displayResult(amount, "EGP", convertedAmount, "USD", fee);
            } else if (operationType === 2 && transactionType === 1) {
                convertedAmount = roundedAmount / 52;
                displayResult(amount, "EGP", convertedAmount, "USD", fee);
            } else if (operationType === 2 && transactionType === 2) {
                convertedAmount = roundedAmount * 52;
                displayResult(amount, "USD", convertedAmount, "EGP", fee);
            }
        }

        function displayResult(originalAmount, originalCurrency, convertedAmount, convertedCurrency, fee) {
            document.getElementById('result').innerHTML = `
                <p>المبلغ المدخل: ${originalAmount} ${originalCurrency}</p>
                <p>الرسوم: ${fee * 100}%</p>
                <p><strong>الإجمالي: ${Math.floor(convertedAmount * 100) / 100} ${convertedCurrency}</strong></p>
            `;
            document.getElementById('result').style.display = 'block';

            document.getElementById('chatButton').style.display = 'block';
            document.getElementById('chatButton').onclick = function() {
                sendToMessenger(originalAmount, originalCurrency, convertedCurrency, operationType, transactionType);
            };
        }

        function sendToMessenger(amount, fromCurrency, toCurrency, operationType, transactionType) {
            const operation = operationType === 1 ? 'سحب' : 'إيداع';
            const transaction = transactionType === 1 ? 'دفع' : 'استلام';
            const message = `Amount:${amount}${fromCurrency}-Converted:${toCurrency}-Operation:${operation}-Transaction:${transaction}`;
            const messengerUrl = `https://m.me/7ossam.tarek?ref=${encodeURIComponent(message)}`;
            window.location.href = messengerUrl;
        }
    </script>
</body>
</html>
